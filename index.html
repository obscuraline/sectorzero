<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ZERO SECTOR MAP v0.9 — ARCHIVE TERMINAL</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;700&display=swap');

html, body, #info-panel, h2, .description, .meta-line {
  font-family: 'IBM Plex Mono', monospace;
}

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: #000;
  color: #c00;
  overflow: hidden;
  image-rendering: pixelated;
}

#app {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  padding: 2.2vh 2.8vw;
  box-sizing: border-box;
  position: relative;
  background: #000;                      /* убрали общий градиент с #app */
}

/* scanlines оставляем на весь экран (или можно тоже перенести на #map-container) */
#app::before {
  content: "";
  position: fixed;
  inset: 0;
  pointer-events: none;
  background: repeating-linear-gradient(
    to bottom,
    transparent 0 2px,
    rgba(160,0,0,0.035) 2px,
    rgba(160,0,0,0.035) 4px
  );
  z-index: 5;
  animation: scan 80s linear infinite;
}

@keyframes scan {
  to { background-position: 0 120px; }
}

#content {
  flex: 1;
  display: flex;
  gap: 2.2vw;
  min-height: 0;
  position: relative;
  z-index: 3;
}

/* vignette ТОЛЬКО на карту */
#map-container {
  flex: 75;
  position: relative;
  background: rgba(6,0,0,0.78);
  border: 1px solid #400;
  overflow: hidden;
  box-shadow: inset 0 0 50px rgba(100,0,0,0.35);
  /* добавляем vignette */
}

#map-wrapper {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

#map-wrapper svg {
  max-width: 100%;
  max-height: 100%;
  width: auto;
  height: auto;
  object-fit: contain;
  filter: brightness(0.92) contrast(1.06) sepia(0.08) hue-rotate(350deg);
}

#map-container::before {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: radial-gradient(circle at 50% 50%, transparent 45%, #000 88%);
  z-index: 3;                            /* выше карты, но ниже оверлея если он есть */
}

/* лёгкий красный оверлей на карту (пункт 6) */
#map-container::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(to bottom, rgba(180,0,0,0.07) 0%, rgba(100,0,0,0.12) 100%);
  pointer-events: none;
  mix-blend-mode: multiply;
  z-index: 2;
}

/* Улучшаем поведение пустой панели */
#info-panel {
  flex: 25;
  background: rgba(4,0,0,0.94);
  border: 2px solid #500;
  box-shadow: 0 0 28px rgba(160,0,0,0.3);
  padding: 0;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  transition: border-color 0.4s, box-shadow 0.6s;
  color: #c33;
}

#info-content {
  visibility: hidden;
  height: 0;
  overflow: hidden;
  opacity: 0;
  transition: opacity 0.25s ease, visibility 0s linear 0.25s;
  display: flex;
  flex-direction: column;
  height: 100%;
}

#info-content.visible {
  visibility: visible;
  height: auto;
  opacity: 1;
  transition: opacity 0.25s ease, visibility 0s linear 0s;
}

.info-image-fixed {
  flex: 0 0 33.33%;               /* фиксированная доля высоты */
  background: rgba(10,0,0,0.7);
  border-bottom: 1px solid #500;
  display: none;                  /* скрыт по умолчанию */
  align-items: center;
  justify-content: center;
  padding: 1vh 1vw;
}

.no-signal {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: repeating-linear-gradient(
    45deg,
    rgba(200,0,0,0.12),
    rgba(200,0,0,0.12) 10px,
    transparent 10px,
    transparent 20px
  );
  border: 2px solid #600;
  color: #800;
  font-size: 1.35em;
  text-align: center;
  line-height: 1.3;
}

.no-signal small {
  font-size: 0.68em;
  color: #700;
  margin-top: 0.5em;
}

/* Блок с текстом — нижняя часть */
.info-text-fixed {
  flex: 1;                        /* забирает всё остальное пространство */
  display: none;                  /* скрыт по умолчанию */
  padding: 1.4vh 1.6vw;
  overflow-y: auto;
  flex-direction: column;
  gap: 0.9em;
}
/* когда ничего не выбрано — делаем панель "пустой" визуально */
#info-panel:not(.has-selection) {
  border-color: #500;
  box-shadow: 0 0 16px rgba(80,0,0,0.2);
}

#info-panel.has-selection {
  border-color: #c00;
  box-shadow: 0 0 32px rgba(220,0,0,0.5), inset 0 0 40px rgba(160,0,0,0.2);
  animation: panel-pulse 6s ease-in-out infinite alternate;
}

@keyframes panel-pulse {
  0%   { box-shadow: 0 0 24px rgba(200,0,0,0.4), inset 0 0 30px rgba(160,0,0,0.15); }
  100% { box-shadow: 0 0 50px rgba(255,0,0,0.7), inset 0 0 55px rgba(200,0,0,0.3); }
}

/* Placeholder — только когда ничего не выбрано */
#info-placeholder {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #600;
  font-size: 1.3em;
  text-align: center;
  opacity: 0.75;
}

#info-panel.has-selection #info-placeholder,
#info-panel.preview-active {  /* если хочешь отдельный класс для hover */
  display: none;
}

.zone {
  fill: transparent;
  cursor: crosshair;
  transition: fill .25s, stroke .25s;
}
.zone.enabled:hover {
  fill: rgba(180,0,0,0.14);
  stroke: rgba(220,0,0,0.8);
  stroke-width: 2.4;
}
.zone.active {
  fill: rgba(220,0,0,0.35);
  stroke: rgba(255,60,60,0.95);
  stroke-width: 2.8;
  filter: drop-shadow(0 0 12px #f40) drop-shadow(0 0 20px #800);
}

/* типографика */
h2 {
  color: #e00;                      /* чуть более тёмный красный */
  text-shadow: none;                /* убрать glow полностью */
  font-weight: 500;                 /* не жирный */
  letter-spacing: 0.5px;            /* лёгкий разряд */
}
@keyframes title-flicker {
  0%, 92%, 94%, 96%, 100% { opacity: 1; text-shadow: 0 0 6px #f00, 0 0 12px #800; }
  93%  { opacity: 0.92; text-shadow: 1px 0 #f00, -1px 0 #00f; }
  95%  { opacity: 0.96; text-shadow: -1px 0 #f00, 1px 0 #0f0; }
}

.meta-line strong,
.meta-line {
  color: #c40;                      /* приглушённый оранжево-красный */
  text-shadow: none;
}
  
/* Описание может скроллиться, если очень длинное */
.description {
  flex: 1;
  overflow-y: auto;
  margin: 0.4em 0 0 0;
  padding-top: 0.8em;
  border-top: 1px solid #500;
  white-space: pre-wrap;
  font-size: 1.12em;
  color: #b22;
  line-height: 1.45;
}

#info-empty {
  color: #600;
  font-size: 1.3em;
  text-align: center;
  margin: auto 0;
  opacity: 0.75;
}

/* Мобильная версия — поворот карты в портрете */ 
@media (max-width: 1024px) and (orientation: portrait) {

  #app, #content, body, html {
    overflow: hidden !important;
    margin: 0 !important;
    padding: 0 !important;
  }

  #map-container {
    width: 100vw;
    height: 100vh;
    margin: 0;
    padding: 0;
    overflow: hidden;
    position: relative;
    background: #000;
  }

  /* Виньетка — тёмные края */
  #map-container::before {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    background: radial-gradient(
      ellipse at center,
      transparent 35%,
      rgba(0,0,0,0.4) 65%,
      rgba(0,0,0,0.85) 90%
    );
    z-index: 2;
  }

  #map-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    width: 100vh;
    height: 100vw;
    transform-origin: top left;
    transform: rotate(90deg) translateY(-100%);
    z-index: 1;
  }

  #map-wrapper svg {
    width: 100%;
    height: 100%;
    max-width: none;
    max-height: none;
    display: block;
    object-fit: contain;
  }

/* Виньетка остаётся на месте, но без влияния на текст */
#map-container::before {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: radial-gradient(
    ellipse at center,
    transparent 28%,
    rgba(0,0,0,0.5) 60%,
    rgba(0,0,0,0.95) 90%
  );
  z-index: 2;
}

/* Новый независимый блок подсказки */
#mobile-hint {
  position: absolute;
  inset: 0;
  z-index: 10;                      /* очень высоко, поверх всего */
  pointer-events: none;
  
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  
  color: #ff0000;                   /* чистый яркий красный */
  font-size: clamp(2.4rem, 11vw, 6.2rem);
  font-weight: 900;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  line-height: 1.2;
  
  /* Максимальная обводка и тень */
  -webkit-text-stroke: 4px #000000;
  text-stroke: 4px #000000;
  text-shadow: 
    0 0 25px #000,
    6px 6px 0 #000,
    -6px -6px 0 #000,
    6px -6px 0 #000,
    -6px 6px 0 #000,
    0 10px 0 #000,
    10px 0 0 #000,
    0 -10px 0 #000,
    -10px 0 0 #000;
  
  /* Красный ореол */
  filter: drop-shadow(0 0 30px rgba(255,0,0,0.85))
          drop-shadow(0 0 50px rgba(255,0,0,0.6));
  
  transition: opacity 0.8s ease, transform 0.8s ease;
  opacity: 1;
}

/* Исчезновение после касания */
#map-container.touched #mobile-hint {
  opacity: 0;
  transform: scale(0.9);
}

/* Опционально: лёгкая подложка, если обводки всё ещё мало */
#mobile-hint.has-backdrop {
  background: rgba(10, 0, 0, 0.70);
  backdrop-filter: blur(8px);
  padding: 1.4em 2.8em;
  border-radius: 20px;
  border: 3px solid rgba(180,0,0,0.35);
  max-width: 90%;
}
  /* Скрываем всё лишнее */
  #info-panel,
  #app::before,
  #map-container > *:not(#map-wrapper):not(#map-wrapper svg),
  #content > *:not(#map-container) {
    display: none !important;
  }
}

/* Опционально: ландшафт на мобильных — без поворота, карта на весь экран */
@media (max-width: 1024px) and (orientation: landscape) {
  #map-container {
    width: 100%;
    height: 100%;
  }

  #map-wrapper {
    transform: none;
  }

  #map-wrapper svg {
    width: 100%;
    height: 100%;
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
  }

  /* Пока тоже скрываем инфо-панель, если нужно */
  #info-panel {
    display: none;
  }
}
  
</style>
</head>
<body>

<div id="app">
  <div id="content">
    <div id="map-container">
      <div id="map-wrapper">
        <svg viewBox="0 0 2048 1360" preserveAspectRatio="xMidYMid meet">
          <image href="assets/maps/open_6_6.png" width="2048" height="1360"></image>
            <!-- Зоны (без изменений координат) -->
            <polygon class="zone" data-zone="1" points="459.5,906.5 -0.5,906.5 -0.5,850.5 28.5,848 28.5,816 181.5,816 199.5,830 248.5,841.5 281,841.5 328.5,826 384.5,786 408,737 413.5,671 408,650 384.5,603.5 350,571 271.5,547.5 216.5,556 167,585.5 150.5,581.5 150.5,563.5 123.5,563.5 123.5,628.5 110,662.5 0,662.5 0,387 136,387 139,393 239,393 239,440 253.5,440 253.5,343 317.5,336 317.5,460 347,460 347,321.5 388,279.5 408.5,235 412,187.5 412,136.5 456,136.5 456,91.5 543,91.5 543,72.5 587.5,72.5 587.5,125 632,125 632,336 814.5,339.5 814.5,386 827.5,386 895,457.5 760,656 677,659.5 677,721.5 722.5,724 722.5,735.5 677,735.5 680.5,753 741,753 741,813 705.5,813 705.5,870.5 760,870.5 760,885.5 677,885.5 677,850.5 506.5,850.5 506.5,802.5 454.5,802.5 452,793 397.5,793 397.5,850.5 459.5,850.5 459.5,906.5"></polygon>

            <polygon class="zone" data-zone="2" points="774,906 774,925.5 853,925.5 853,938.5 1020,937 1020,930 1253,932.5 1355,853 1351.5,583 1305,550.5 1282.5,447 1264,427 1138,425 1138,396 976.5,397.5 976.5,455.5 891.5,455.5 758,653.5 758,721 737,721 737,735 786.5,735 786.5,756 739.5,756 739.5,811 774,811 774,870.5 761,870.5 761,884.5 783.5,884.5 783.5,906 774,906"></polygon>

            <polygon class="zone" data-zone="3" points="978.5,456 976.5,397.5 1136,399.5 1137,427 1264,429 1270,388.5 1270,118.5 1242,118.5 1242,114 1220,114 1219,92 1198,63 701.5,64 701.5,74.5 692,74.5 692,122 631,123 631,338 813,340.5 814,386 825.5,386 892.5,457.5 978.5,456"></polygon>

            <polygon class="zone" data-zone="4" points="1267,116 1269,388 1369,388.5 1368,368.5 1400,367.5 1399,429.5 1552,431 1552,427 1673,427 1673,423 1763,423 1763,408.5 1924,406.5 1924,284 2047,282 2048,102 1849,100 1849,47 1334.5,48.5 1334.5,62 1326,62 1327,113 1267,116"></polygon>

            <polygon class="zone" data-zone="5" points="1352,586 1355,853 1681,853 1682,795 1819,794 1818,724 1861,724 1860,665 1909,664 1906,611 1864,610 1865,579 1951,578 1952,532 2047,533 2047,415 1924,416.5 1923,405 1761,406 1761,422 1671,422 1671,426 1551,425 1551,428 1400,427 1400,365 1367,366 1366,388 1269,386.5 1263,429.5 1281,448.5 1305,552 1352,586"></polygon>

            <polygon class="zone" data-zone="6" points="1355,947 1355,851 1253,930 1252,953 1182,953 1181,986 1096,986 1096,1040 983,1044 982,1083 898,1086 897,1141 954,1141 954,1187 1117,1187 1119,1147 1227,1147.5 1229,1219 1492,1220 1492,1256 1585,1254 1587,1298 1867,1305 1866,1259 1951,1257 1948,1195 1942,1194 1939,1166 1950,1164 1948,1133 1976,1126 1977,1117 1971,1112 1964,1082 1961,1002 1939,964 1933,965 1927,961 1921,966 1855,916 1760,894 1757,886 1748,883 1748,852 1716,852 1715,889 1601,889 1602,906 1475,911 1474,934 1438,933 1438,945 1355,947"></polygon>

        </svg>
      </div>
      <div id="mobile-hint">ВЫБЕРИТЕ ЗОНУ НА КАРТЕ</div>
    </div>

   <div id="info-panel">
      <div id="info-placeholder" class="info-placeholder">Выберите сектор на карте</div>

      <div id="info-image-fixed" class="info-image-fixed">
        <div class="no-signal">
          NO SIGNAL
          <small>Изображение сектора<br>будет здесь</small>
        </div>
      </div>

      <div id="info-text-fixed" class="info-text-fixed">
        <h2 id="i-title"></h2>
        <div class="meta-line"><strong>CLASS:</strong> <span id="i-class"></span></div>
        <div class="meta-line"><strong>STATUS:</strong> <span id="i-status"></span></div>
        <div class="description" id="i-desc"></div>
      </div>
    </div>
  </div>
</div>

<script>
let currentStage = 6;
let activeZone = null;
let typingTimer = null;

const data = {
  1: {
    title: "TRANSIT STATION",
    class: "Auxiliary Transport and Service Area",
    status: "Status: Partially Activated / Unstable",
    desc: "Когда-то это был чётко регламентированный коридор между слоями мегаструктуры. Теперь вертикальные шахты доступа, лифтовые стволы, аварийные лестницы и бесконечные сервисные ленты образуют здесь плотный, перекрученный узел. \nБольшая часть механизмов работает по инерции.",
    image: "assets/info/image_1.png"
  },
  2: {
    title: "INFRASTRUCTURE CORE",
    class: "Critical Infrastructure Node",
    status: "Status: Fully Functional",
    desc: "Здесь сходятся энергоканалы, распределение давления, термальные контуры, первичные вычислительные узлы. \nЭто одно из немногих мест, где чувствуется присутствие исходной логики мегаструктуры до начала эксперимента.",
    image: "assets/info/image_2.png"
  },
  3: {
    title: "HABITATION CLUSTERS",
    class: "Obsolete Residential Areas",
    status: "Status: Fragmented",
    desc: "Модульные жилые блоки, пристроенные друг к другу без единого плана, соединённые переходами, которые давно не числятся в схемах.",
    image: "assets/info/image_3.png"
  },
  4: {
    title: "CENTRAL RESEARCH LAB",
    class: "Research Complex (Closed)",
    status: "Status: Partially Accessible",
    desc: "Лаборатория не числится ни в одном актуальном реестре, но продолжает физически присутствовать в структуре. Здесь использовались старые протоколы, экспериментальные среды, которые позже были запрещены или «утеряны». Большая часть данных либо уничтожена, либо намеренно повреждена. \nИменно здесь впервые зафиксированы несанкционированные изменения среды, которые позже были списаны на «ошибки сборки мегаструктуры».",
    image: "assets/info/image_4.png"
  },
  5: {
    title: "BIOMECHANICAL INTEGRATION SUITE",
    class: "Anomalous Zone",
    status: "Status: Active",
    desc: "Именно здесь начался эксперимент по созданию полностью автоматизированного сектора. Учёными было создано биомеханическое ядро способное самостоятельно расширяться. Рост биомеханической массы оказался непланомерным, несмотря на созданные условия. Биомеханику не удалось сдержать под контролем из-за чего эксперимент был остановлен. \nСектор был закрыт, данные о нём засекречены.",
    image: "assets/info/image_5.png"
  },
  6: {
    title: "LOWER VOID",
    class: "Limit Zone",
    status: "Status: Unstable",
    desc: "Здесь мегаструктура теряет плотность. \nПространство кажется глубже, чем должно быть. \nГравитационные показатели нестабильны. \nБиомеханика стремится к поглощению этой зоны.",
    image: "assets/info/image_6.png"
  }
};


function typeText(el, text) {
  el.textContent = "";
  let i = 0;
  clearInterval(typingTimer);
  typingTimer = setInterval(() => {
    if (i < text.length) {
      el.textContent += text[i++];
    } else {
      clearInterval(typingTimer);
      typingTimer = null;
    }
  }, 38);
}

function showInfo(zoneId, isHover = false) {
  const d = data[zoneId];
  if (!d) return;

  // Заполняем текстовые поля
  document.getElementById('i-title').textContent = d.title;
  document.getElementById('i-class').textContent = d.class;
  document.getElementById('i-status').textContent = d.status;
  document.getElementById('i-desc').textContent = '';

  // Запускаем печать описания
  typeText(document.getElementById('i-desc'), d.desc);

  // Показываем изображение вместо заглушки
  const imageBlock = document.getElementById('info-image-fixed');
  imageBlock.innerHTML = ''; // очищаем старое содержимое

  const img = document.createElement('img');
  img.src = d.image || 'assets/info/placeholder.png'; // fallback, если изображения нет
  img.alt = d.title;
  img.style.width = '100%';
  img.style.height = '100%';
  img.style.objectFit = 'cover'; // или 'contain', если хочешь без обрезки
  img.style.border = '2px solid #600';
  imageBlock.appendChild(img);

  // Показываем блоки
  document.getElementById('info-placeholder').style.display = 'none';
  document.getElementById('info-image-fixed').style.display = 'flex';
  document.getElementById('info-text-fixed').style.display = 'flex';

  if (isHover) {
    document.getElementById('info-panel').classList.add('preview-active');
  } else {
    document.getElementById('info-panel').classList.add('has-selection');
  }
}

function clearInfo(isHover = false) {
  clearInterval(typingTimer);
  typingTimer = null;

  // Очистка полей
  document.getElementById('i-title').textContent = '';
  document.getElementById('i-class').textContent = '';
  document.getElementById('i-status').textContent = '';
  document.getElementById('i-desc').textContent = '';

  // Возвращаем заглушку вместо изображения
  const imageBlock = document.getElementById('info-image-fixed');
  imageBlock.innerHTML = `
    <div class="no-signal">
      NO SIGNAL
      <small>Изображение сектора<br>будет здесь</small>
    </div>
  `;

  // Скрываем блоки
  document.getElementById('info-image-fixed').style.display = 'none';
  document.getElementById('info-text-fixed').style.display = 'none';

  // Показываем placeholder
  document.getElementById('info-placeholder').style.display = 'flex';

  if (isHover) {
    document.getElementById('info-panel').classList.remove('preview-active');
  } else {
    document.getElementById('info-panel').classList.remove('has-selection');
    activeZone?.classList.remove('active');
    activeZone = null;
  }
}

document.querySelectorAll('.zone').forEach(z => {
  const zoneNum = +z.dataset.zone;
  if (zoneNum <= currentStage) {
    z.classList.add('enabled');
  }

  // click остаётся почти без изменений, но используем showInfo без isHover
  z.addEventListener('click', () => {
    if (!z.classList.contains('enabled')) return;

    if (activeZone === z) {
      clearInfo(false);
      return;
    }

    activeZone?.classList.remove('active');
    activeZone = z;
    z.classList.add('active');
    showInfo(+z.dataset.zone, false);   // ← isHover = false
  });
});

// hover
z.addEventListener('mouseenter', () => {
  if (activeZone) return;
  if (!z.classList.contains('enabled')) return;
  showInfo(+z.dataset.zone, true);   // ← isHover = true
});

z.addEventListener('mouseleave', () => {
  if (activeZone) return;
  if (!z.classList.contains('enabled')) return;
  clearInfo(true);                   // ← isHover = true
});
</script>

<script>
  // Скрываем надпись после первого касания/клика по карте
  document.addEventListener('DOMContentLoaded', () => {
    const mapContainer = document.getElementById('map-container');
    if (!mapContainer) return;

    const hideHint = () => {
      mapContainer.classList.add('touched');
      // Удаляем слушатели, чтобы не тратить ресурсы
      document.removeEventListener('touchstart', hideHint);
      document.removeEventListener('click', hideHint);
    };

    // touchstart лучше для мобильных, click как запасной
    document.addEventListener('touchstart', hideHint, { once: true, passive: true });
    document.addEventListener('click', hideHint, { once: true });
  });
</script>
</body>
</html>













